# План реализации интернет-магазина

Документ для курса Hardcode Store: пошаговый план, как сделать интернет-магазин с нуля.

**Текущий фокус:** Этап 0 (подготовка) — инициализация проекта Django, PostgreSQL, первая страница из Django Templates.

**Расположение проекта:** `/new_box/hardcode-store` (на сервере). PostgreSQL уже установлен; для магазина нужно создать отдельную базу — см. раздел «База данных» ниже.

---

## 1. Цели и рамки

- **Цель:** работающий интернет-магазин: каталог, корзина, оформление заказа, админка, контроль остатков, статусы заказа, уведомления (Telegram).
- **Масштаб на старте:** один тип товара, простая оплата/доставка, без мультиязычности и сложной логистики.
- **Результат по этапам:** после каждого этапа есть рабочий кусок, который можно показать и развивать дальше.
- **Архитектура:** остатки товаров и пользователи сейчас хранятся в нашей БД; позже планируется вынос в отдельный сервис (остатки — API учёта/резерва, пользователи — отдельный сервис аутентификации/ЛК). Обращение к остаткам и к данным пользователя закладывать через слой сервисов, чтобы позже подменить реализацию на API без переписывания всей логики. Подробнее: [IM_REQUIREMENTS.md](IM_REQUIREMENTS.md), раздел 8.

---

## 2. Этапы реализации

### Этап 0. Подготовка

- [x] Выбор стека — зафиксирован: Django + PostgreSQL + Django Templates + ванильный JS ([RECOMMENDATION_STACK.md](RECOMMENDATION_STACK.md)).
- [x] **0.1** Инициализация проекта: виртуальное окружение, Django, psycopg2.
- [x] **0.2** Структура проекта: приложения `catalog`, `orders`, папки `templates/`, `static/`.
- [x] **0.3** Подключение к PostgreSQL: база `hardcode_store`, миграции применены.
- [ ] **0.4** Модели БД: в `catalog` — `Category`, `Product`; в `orders` — `Order`, `OrderItem`. Миграции + регистрация в админке. **← следующий шаг**
- [x] **0.5** Первая страница: view главной, шаблон, маршруты.
- [x] **0.6** Базовая вёрстка: `base.html`, статика.

**Результат:** проект поднят, БД создана, в браузере открывается главная с шапкой и подвалом.

---

### Этап 1. Каталог и карточка товара

- [ ] Модель товара: название, описание, цена, изображение(я), **остаток** (контроль обязателен), категория, slug/url.
- [ ] Список товаров: главная или страница «Каталог» — вывод карточек из БД (пагинация или «показать ещё»).
- [ ] Фильтр по категориям (и при желании по цене).
- [ ] Страница товара: по slug/id — полное описание, фото, **остаток на витрине**, кнопка «В корзину» (при нуле — «Под заказ» или скрыть).
- [ ] Адаптив: каталог и карточка нормально выглядят на мобильном.

**Результат:** пользователь может смотреть каталог и открывать карточку товара.

---

### Этап 2. Корзина и оформление заказа

- [ ] Корзина: хранение на фронте (localStorage) или в сессии на бэке (товар, количество, цена).
- [ ] Страница корзины: список позиций, изменение количества, удаление, итоговая сумма.
- [ ] Форма оформления заказа: имя, контакт (телефон/email), адрес доставки, комментарий.
- [ ] Сохранение заказа в БД: таблица `orders` (клиент, сумма, **статус**, дата), `order_items` (товар, количество, цена). При оформлении — **уменьшение остатка** товара (через слой сервиса, с расчётом на вынос остатков в отдельный сервис).
- [ ] Экран «Заказ принят»: номер заказа, что делать дальше (ожидать звонка, оплатить и т.д.).

**Результат:** пользователь добавляет товары в корзину и может оформить заказ; заказ попадает в БД.

---

### Этап 3. Оплата и доставка

- [ ] Выбор способа оплаты: при получении, онлайн (платёжная система).
- [ ] Интеграция одной платёжки (например, ЮKassa, Robokassa, Stripe — по выбору): приём оплаты, webhook для смены статуса заказа.
- [ ] Способы доставки: курьер, пункт выдачи, почта — описание в заказе и в письме/уведомлении.
- [ ] **Статусы заказа (отслеживать):** Новый → Оплачен (если онлайн) → Передан в ТК → В пути → Выполнен; Отмена. Отображение в админке и в ЛК.

**Результат:** можно оплатить заказ онлайн и указать доставку; статусы заказов обновляются.

---

### Этап 4. Админка (обязательно)

- [ ] Вход: логин/пароль (Django Admin или своя авторизация по роли admin).
- [ ] Список заказов: таблица с фильтром по **статусу**, дате; просмотр содержимого заказа.
- [ ] Смена **статуса заказа** из админки (Новый → Оплачен → Передан в ТК → В пути → Выполнен, Отмена).
- [ ] Управление товарами: список, добавление, редактирование (название, цена, описание, фото, **остаток**, категория), снятие с продажи.
- [ ] Управление категориями: список, добавление, редактирование, порядок вывода.
- [ ] Управление способами доставки: справочник ТК (название, тип ПВЗ/курьер).

**Результат:** владелец видит заказы и меняет статусы; правит товары, категории и способы доставки; контролирует остатки.

---

### Этап 5. Доработки и запуск

- [ ] **Уведомления (планируем Telegram):** уведомление клиенту после оформления заказа (состав, контакты, статус); уведомление админу о новом заказе. Детали канала/бота — позже.
- [ ] Поиск по каталогу (по названию/описанию).
- [ ] SEO: мета-теги, заголовки, при необходимости sitemap.
- [ ] Выкладка на прод: домен, SSL, бэкапы БД, мониторинг ошибок.

**Результат:** магазин готов к первому «боевому» запуску и поддержке.

---

## 3. Технический стек

**Выбранный стек под VPS + PostgreSQL + планы PWA:** см. [RECOMMENDATION_STACK.md](RECOMMENDATION_STACK.md).

- **Бэкенд:** Django
- **БД:** PostgreSQL
- **Фронт:** серверный рендер (Django Templates) + ванильный JS; позже PWA (manifest + Service Worker)
- **Хостинг:** арендуемый VPS

Варианты для других условий — в [STACK_CHOICE.md](STACK_CHOICE.md).

---

## 4. База данных

**Сервер:** PostgreSQL уже установлен на сервере. Для магазина создаётся **отдельная база** (не использовать существующие БД других проектов).

**Создание базы и пользователя (один раз на сервере):**

```bash
# Подключиться к PostgreSQL от суперпользователя (postgres или свой пользователь)
sudo -u postgres psql

# В консоли psql:
CREATE DATABASE hardcode_store;
CREATE USER hardcode_store_user WITH ENCRYPTED PASSWORD 'твой_пароль';
GRANT ALL PRIVILEGES ON DATABASE hardcode_store TO hardcode_store_user;
\c hardcode_store
GRANT ALL ON SCHEMA public TO hardcode_store_user;
\q
```

Строка подключения в проекте (в `.env`):  
`DATABASE_URL=postgresql://hardcode_store_user:твой_пароль@localhost:5432/hardcode_store`

---

## 5. Структура БД (черновик)

- **users** — id, email, password_hash, name, phone, role (customer/admin), created_at. *Позже возможен вынос в отдельный сервис.*
- **categories** — id, name, slug, parent_id, sort_order  
- **products** — id, category_id, name, slug, description, price, **stock** (остаток, контроль обязателен), image(s), is_active, created_at, updated_at. *Остаток позже возможен из отдельного сервиса.*
- **delivery_methods** — id, name, code (ТК), type (ПВЗ/курьер), is_active, sort_order — справочник способов доставки (ТК).
- **orders** — id, user_id (nullable), name, phone, email, address, **delivery_method_id**, delivery_city, delivery_address, payment_type, total, **status** (новый/оплачен/передан в ТК/в пути/выполнен/отменён), comment, created_at  
- **order_items** — id, order_id, product_id, name, price, quantity  

При необходимости добавить: купоны, отзывы, избранное — отдельными этапами после базового запуска.

---

## 6. Дорожная карта (порядок работ)

| # | Этап | Фокус | Результат |
|---|------|--------|-----------|
| 0 | Подготовка | Проект, БД, первая страница | Запускается сервер, открывается главная с layout |
| 1 | Каталог | Товары из БД, категории, карточка товара | Можно смотреть каталог и страницу товара |
| 2 | Корзина и заказ | Корзина (localStorage/сессия), форма, сохранение заказа | Можно оформить заказ, он попадает в БД |
| 3 | Оплата и доставка | Платёжка, способы доставки, статусы | Оплата онлайн, смена статусов |
| 4 | Админка | Вход, заказы, товары, категории | Владелец управляет заказами и каталогом |
| 5 | Запуск | Письма, уведомления, поиск, SEO, прод | Магазин в проде, можно поддерживать |

**Следующий шаг:** выполнить пункты 0.1–0.6 (инициализация проекта Django, PostgreSQL, первая страница из Django Templates).

Дальше можно развивать: личный кабинет, рекомендации, аналитику, интеграции с 1С/маркетплейсами и т.д. — отдельными планами.

---

## 7. Структура проекта (Django)

Корень проекта на сервере: **`/new_box/hardcode-store`**. Черновик структуры для этапа 0:

```
/new_box/hardcode-store/  # корень проекта
├── manage.py             # точка входа Django
├── store/                # главный модуль проекта (создаётся django-admin startproject)
│   ├── __init__.py
│   ├── settings.py       # настройки: БД, INSTALLED_APPS, STATIC_URL, TEMPLATES
│   ├── urls.py           # главный роутинг
│   ├── wsgi.py
│   └── asgi.py
├── catalog/               # приложение каталога (python manage.py startapp catalog)
│   ├── __init__.py
│   ├── models.py         # модели Category, Product
│   ├── views.py          # views для каталога, товара
│   ├── urls.py           # маршруты каталога
│   ├── admin.py          # регистрация моделей в админке
│   └── templates/
│       └── catalog/      # шаблоны каталога (base.html, product_list.html, product_detail.html)
├── orders/               # приложение заказов (python manage.py startapp orders)
│   ├── models.py         # модели Order, OrderItem
│   ├── views.py          # views для корзины, оформления заказа
│   ├── urls.py
│   └── templates/
│       └── orders/      # шаблоны заказов (cart.html, order_form.html)
├── static/               # статика (CSS, JS, изображения)
│   ├── css/
│   ├── js/
│   └── images/
├── media/                # загружаемые файлы (фото товаров) — настроить в settings.py
├── .env                  # не в git: SECRET_KEY, DATABASE_URL, DEBUG
├── requirements.txt      # зависимости: Django, psycopg2-binary
└── doc/                  # план, стек, заметки (уже есть)
```

Детали (имена приложений, разбиение views) можно менять по ходу; главное — разделение по приложениям (catalog, orders), модели в `models.py`, шаблоны в `templates/`, статика в `static/`.
